<% @page_title = 'Загрузка Excel файла' %>

<div class="app-header">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1><i class="bi bi-upload me-2"></i>Загрузка данных из Excel</h1>
                <p>Импорт данных пациентов</p>
            </div>
            <div>
                <a href="/" class="btn btn-light">
                    <i class="bi bi-arrow-left me-1"></i>Назад
                </a>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="app-card">
                <div class="card-body">
                    <% if params[:error] == 'no_file' %>
                        <div class="alert alert-danger mb-4">
                            <i class="bi bi-exclamation-triangle me-2"></i>Пожалуйста, выберите файл для загрузки
                        </div>
                    <% end %>

                    <form action="/upload" method="post" enctype="multipart/form-data">
                        <div class="mb-3">
                            <label class="form-label">Отделение</label>
                            <select name="department" class="form-select" required>
                                <% @departments.each do |dept| %>
                                    <option value="<%= dept[:short] %>">
                                        <%= dept[:short] %> - <%= dept[:full] %>
                                    </option>
                                <% end %>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Дата</label>
                            <input type="date" name="date" value="<%= Date.today %>" class="form-control" required>
                            <div class="form-text text-smaller">
                                Данные будут импортированы на указанную дату
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Excel файл (.xlsx)</label>
                            <input type="file" name="file" class="form-control" accept=".xlsx" required>
                            <div class="form-text text-smaller mt-1">
                                Файл должен содержать столбцы:
                                <ul class="mb-0">
                                    <li>A - № палаты (начиная с A5)</li>
                                    <li>B - ФИО пациента (начиная с B5)</li>
                                    <li>C - Дата рождения (начиная с C5)</li>
                                    <li>J - Дата родов (начиная с J5)</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="alert alert-info mb-4">
                            <i class="bi bi-info-circle me-2"></i>
                            При импорте на дату, когда уже есть данные, старые данные будут удалены.
                            Пациенты с одинаковыми ФИО, датой рождения и датой родов 
                            получат данные из предыдущего дня (кроме термометрии, стола и "Где ребёнок").
                        </div>
                        
                        <div class="d-flex gap-2">
                            <a href="/" class="btn btn-secondary">Назад</a>
                            <button type="submit" class="btn btn-primary">Загрузить</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>